# Forum Application

A Spring Boot-based forum application that provides REST API endpoints for managing threads, subthreads, messages, and user interactions with model-specific access control.

## 🛠️ Technologies & Dependencies

### Core Framework
- **Spring Boot 3.1.5** - Main application framework
- **Java 21** - Programming language
- **Maven** - Dependency management and build tool

### Database & Persistence
- **Spring Data JPA** - Data access layer
- **PostgreSQL** - Primary database
- **Hibernate** - ORM implementation

### Security & Validation
- **Spring Security** - Authentication and authorization
- **Spring Boot Validation** - Input validation

### Documentation & Development
- **SpringDoc OpenAPI 3** (v2.1.0) - API documentation and Swagger UI
- **Spring Boot DevTools** - Development utilities
- **Lombok** - Code generation (getters, setters, constructors)

### Additional Features
- **Spring Boot Actuator** - Application monitoring
- **Spring Boot Docker Compose** - Container integration

## 🚀 Getting Started

### Prerequisites
- Java 21
- PostgreSQL database
- Maven (or use VS Code with Java Extension Pack)

### Database Setup
1. Create a PostgreSQL database named `forum`
2. Update database credentials in `src/main/resources/application.yml`
3. The application will automatically create tables and insert dummy data on startup

### Running the Application
1. Clone the repository
2. Open in VS Code or your preferred IDE
3. Run the `ForumApplication.java` main class
4. Application will start on `http://localhost:8080`

## 📚 API Documentation (Swagger UI)

### Accessing Swagger UI
Once the application is running, access the interactive API documentation at:
**🔗 [http://localhost:8080/swagger-ui.html](http://localhost:8080/swagger-ui.html)**

### 📋 Available API Endpoints

#### 🧵 Thread Management
- **GET** `/threads/getAllThreads` - Retrieve all threads
- **POST** `/threads/createThread` - Create a new thread
- **GET** `/threads/{id}` - Get thread by ID
- **DELETE** `/threads/deleteThread/{id}` - Delete a thread

#### 🌿 SubThread Management  
- **GET** `/subThreads/allSubThreadsByThreadId/{threadId}` - Get all subthreads for a specific thread
- **POST** `/subThreads/createSubThread` - Create a new subthread
- **GET** `/subThreads/{id}` - Get subthread by ID
- **DELETE** `/subThreads/deleteSubThread/{id}` - Delete a subthread

#### 💬 Message Management
- **GET** `/messages/allMessagesBySubThreadId/{id}` - Get all messages for a specific subthread
- **POST** `/messages/createMessage` - Create a new message
- **GET** `/messages/{id}` - Get message by ID
- **DELETE** `/messages/deleteMessage/{id}` - Delete a message

#### 👍 Message Voting
- **POST** `/messageVotes/createMessageVote` - Vote on a message
- **DELETE** `/messageVotes/deleteMessageVote/{id}` - Remove a vote

## 🎯 How to Use Swagger UI for Testing

### ⚠️ Important Note About Input Fields
When using Swagger UI to test endpoints, you'll see JSON input examples that include fields like `id`, `createdAt`, `updatedAt`, etc. **These fields should be DELETED from your input** as they are auto-generated by the system.

### 📝 Input Examples for Each Endpoint

#### Creating a Thread
**Endpoint:** `POST /threads/createThread`

**❌ Default Swagger Input (Don't use this):**
```json
{
  "id": 0,
  "username": "string",
  "role": 0,
  "modelId": "string",
  "title": "string",
  "createdAt": "2025-09-08T18:48:24.337Z"
}
```

**✅ Correct Input (Use this):**
```json
{
  "username": "alice_johnson",
  "role": 0,
  "modelId": "BMW",
  "title": "Best BMW maintenance tips"
}
```

#### Creating a SubThread
**Endpoint:** `POST /subThreads/createSubThread`

**✅ Correct Input:**
```json
{
  "username": "bob_smith",
  "title": "Engine maintenance discussion",
  "threadId": 1
}
```

#### Creating a Message
**Endpoint:** `POST /messages/createMessage`

**✅ Correct Input:**
```json
{
  "username": "charlie_brown",
  "body": "This is my message content about car maintenance.",
  "subthreadId": 1
}
```

#### Creating a Message Vote
**Endpoint:** `POST /messageVotes/createMessageVote`

**✅ Correct Input:**
```json
{
  "username": "diana_wilson",
  "messageId": 1
}
```

## 👥 Available Test Users

The application comes with pre-populated test users you can use:

| Username | Model ID | Role | Message/Description |
|----------|----------|------|---------------------|
| alice_johnson | BMW | 0 (Admin) | Hi, I'm Alice and I love cars! |
| bob_smith | Mercedes | 1 (User) | Greetings from Bob, car enthusiast. |
| charlie_brown | Audi | 1 (User) | Charlie here, always ready to help! |
| diana_wilson | Tesla | 1 (User) | Diana's passion for electric vehicles. |
| eve_davis | BMW | 1 (User) | Eve enjoys weekend car meets. |
| frank_miller | Mercedes | 0 (Admin) | Frank has years of automotive experience. |
| grace_lee | Audi | 1 (User) | Grace appreciates German engineering. |
| henry_taylor | Tesla | 1 (User) | Henry is an advocate for sustainable transport. |

### Using Test Users
When making API calls, use the **username** field with one of the usernames above (e.g., `"username": "alice_johnson"`).

## 🔒 Access Control Rules

### Model-Based Restrictions
- Users can only create **threads** for their assigned `model_id`
- Users can only create **subthreads** in threads that match their `model_id`
- **Cross-model posting is blocked** - BMW users cannot post in Mercedes threads

### Validation Flow
1. **Thread Creation:** User's `model_id` must match thread's `model_id`
2. **SubThread Creation:** User's `model_id` must match parent thread's `model_id`
3. **Message Creation:** User must exist and have valid access to the subthread

## 🛡️ Error Handling

The application uses a global exception handler that returns clean JSON error responses:

### Example Error Response
```json
{
  "status": false,
  "message": "[UserNotFoundException] User 'alice_johnson' does not have a model_id assigned. Cannot perform operation.",
  "data": null
}
```

### Common Error Types
- **UserNotFoundException** (404) - User doesn't exist or has no model_id
- **IdMismatchException** (400) - User's model_id doesn't match required model_id
- **MissingRelationException** (400) - Required parent entity not found

## 🗄️ Database Schema

### Tables
- **users** - User accounts with model assignments and personal messages
- **threads** - Main discussion topics  
- **subthreads** - Sub-discussions within threads
- **messages** - Individual posts within subthreads
- **message_vote** - Upvoting system for messages

### Key Relationships
- Thread → SubThread (one-to-many)
- SubThread → Message (one-to-many)  
- User → Message Vote (many-to-many through message_vote table)

## 🧪 Testing Workflow

1. **Start with Threads:** Create a thread using one of the test usernames (e.g., `"username": "alice_johnson"`)
2. **Add SubThreads:** Create subthreads within your thread using the same username
3. **Post Messages:** Add messages to subthreads
4. **Vote on Messages:** Use the voting system to upvote messages
5. **Test Restrictions:** Try cross-model posting (e.g., BMW user posting in Mercedes thread) to see access control in action

### Example Cross-Model Testing
- Try `alice_johnson` (BMW) creating a thread with `"modelId": "Mercedes"` → Should fail
- Try `bob_smith` (Mercedes) creating a subthread in a BMW thread → Should fail

## 📊 Response Format

All API responses follow this consistent format:

```json
{
  "status": boolean,
  "message": "string",
  "data": object | null
}
```

- **status**: `true` for success, `false` for errors
- **message**: Descriptive message about the operation
- **data**: The actual response data or `null` for errors

---

**🚀 Happy API Testing!** Use the Swagger UI interface for easy testing and exploration of all available endpoints. Remember to use **usernames** (not user IDs) in your API calls!